<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Lianhua Zhu&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Lianhua Zhu&apos;s Personal Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Lianhua Zhu's Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Lianhua Zhu's Blog">
<meta property="og:description" content="Lianhua Zhu&apos;s Personal Blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lianhua Zhu's Blog">
<meta name="twitter:description" content="Lianhua Zhu&apos;s Personal Blog">
  
    <link rel="alternate" href="/atom.xml" title="Lianhua Zhu&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Lianhua Zhu&#39;s Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-of-dsmcFoam" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/10/07/of-dsmcFoam/" class="article-date">
  <time datetime="2016-10-07T07:33:29.000Z" itemprop="datePublished">2016-10-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/07/of-dsmcFoam/">OpenFOAM中的DSMC求解器dsmcFoam分析</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="dsmcFoam-solver分析"><a href="#dsmcFoam-solver分析" class="headerlink" title="dsmcFoam solver分析"></a>dsmcFoam solver分析</h3><p>dsmcFoam 的架构：</p>
<p>主要的源文件：</p>
<ul>
<li><a href="https://github.com/OpenFOAM/OpenFOAM-2.3.x/blob/master/applications/solvers/discreteMethods/dsmc/dsmcFoam/dsmcFoam.C" target="_blank" rel="external"><code>dsmcFoam.C</code></a></li>
<li><a href="https://github.com/OpenFOAM/OpenFOAM-2.3.x/blob/master/src/lagrangian/dsmc/clouds/Templates/DsmcCloud/DsmcCloud.C" target="_blank" rel="external"><code>DsmcCloud.C</code></a></li>
<li><a href="https://github.com/OpenFOAM/OpenFOAM-2.3.x/blob/master/src/lagrangian/dsmc/clouds/Templates/DsmcCloud/DsmcCloud.H" target="_blank" rel="external"><code>DsmcCloud.H</code></a></li>
<li><a href="https://github.com/OpenFOAM/OpenFOAM-2.3.x/tree/master/src/postProcessing/functionObjects/utilities/dsmcFields" target="_blank" rel="external"><code>dsmcFields</code> function object</a></li>
</ul>
<h4 id="dsmcFoma-源码："><a href="#dsmcFoma-源码：" class="headerlink" title="dsmcFoma 源码："></a><code>dsmcFoma</code> 源码：</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></div><div class="line">&#123;</div><div class="line">    <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"setRootCase.H"</span></span></div><div class="line">    <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"createTime.H"</span></span></div><div class="line">    <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"createMesh.H"</span></span></div><div class="line"></div><div class="line">    <span class="comment">// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //</span></div><div class="line"></div><div class="line">    Info&lt;&lt; nl &lt;&lt; <span class="string">"Constructing dsmcCloud "</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line"></div><div class="line">    <span class="function">dsmcCloud <span class="title">dsmc</span><span class="params">(<span class="string">"dsmc"</span>, mesh)</span></span>;</div><div class="line"></div><div class="line">    Info&lt;&lt; <span class="string">"\nStarting time loop\n"</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line"></div><div class="line">    <span class="keyword">while</span> (runTime.loop())</div><div class="line">    &#123;</div><div class="line">        Info&lt;&lt; <span class="string">"Time = "</span> &lt;&lt; runTime.timeName() &lt;&lt; nl &lt;&lt; <span class="built_in">endl</span>;</div><div class="line"></div><div class="line">        dsmc.evolve(); <span class="comment">//&lt;&lt;------ 这里是演化步</span></div><div class="line">        dsmc.info();  <span class="comment">//&lt;&lt;------ dump到屏幕一些基本信息</span></div><div class="line">        runTime.write(); <span class="comment">//&lt;&lt;------- 这里很关键，到底写的是什么</span></div><div class="line"></div><div class="line">        Info&lt;&lt; nl &lt;&lt; <span class="string">"ExecutionTime = "</span> &lt;&lt; runTime.elapsedCpuTime() &lt;&lt; <span class="string">" s"</span></div><div class="line">            &lt;&lt; <span class="string">"  ClockTime = "</span> &lt;&lt; runTime.elapsedClockTime() &lt;&lt; <span class="string">" s"</span></div><div class="line">            &lt;&lt; nl &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    Info&lt;&lt; <span class="string">"End\n"</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line"></div><div class="line">    <span class="keyword">return</span>(<span class="number">0</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="DsmcCloud-关键函数分析"><a href="#DsmcCloud-关键函数分析" class="headerlink" title="DsmcCloud 关键函数分析"></a>DsmcCloud 关键函数分析</h4><p><code>DsmcCloud::evolve()</code> 主要演化过程在这里</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ParcelType&gt;</div><div class="line"><span class="keyword">void</span> Foam::DsmcCloud&lt;ParcelType&gt;::evolve()</div><div class="line">&#123;</div><div class="line">    <span class="keyword">typename</span> ParcelType::<span class="function">trackingData <span class="title">td</span><span class="params">(*<span class="keyword">this</span>)</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">// Reset the data collection fields</span></div><div class="line">    resetFields();  <span class="comment">//&lt;&lt;------ 每个演化步都需要重置 rhoN_ rhoM_ linearKE_ ... 等等这些场为0；</span></div><div class="line"></div><div class="line">    <span class="keyword">if</span> (debug)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">this</span>-&gt;dumpParticlePositions();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Insert new particles from the inflow boundary</span></div><div class="line">    <span class="keyword">this</span>-&gt;inflowBoundary().inflow();  <span class="comment">//&lt;&lt;------ 处理边界</span></div><div class="line"></div><div class="line">    <span class="comment">// Move the particles ballistically with their current velocities</span></div><div class="line">    Cloud&lt;ParcelType&gt;::move(td, mesh_.time().deltaTValue()); <span class="comment">//&lt;&lt;------ 自由迁移，得到particle新的位置</span></div><div class="line"></div><div class="line">    <span class="comment">// Update cell occupancy</span></div><div class="line">    buildCellOccupancy(); <span class="comment">//&lt;&lt;-------</span></div><div class="line"></div><div class="line">    <span class="comment">// Calculate new velocities via stochastic collisions</span></div><div class="line">    collisions(); <span class="comment">//&lt;&lt;------ 碰撞处理，得到particle新的速度</span></div><div class="line"></div><div class="line">    <span class="comment">// Calculate the volume field data</span></div><div class="line">    calculateFields(); <span class="comment">//&lt;&lt;------每个演化步都需要统计 rhoN_ rhoM_ linearKE_ ... 等等这些场为；</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>DsmcCloud::resetFields()</code> 每个演化步都需要重置这些场为0，为开始统计做准备</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ParcelType&gt;</div><div class="line"><span class="keyword">void</span> Foam::DsmcCloud&lt;ParcelType&gt;::resetFields()</div><div class="line">&#123;</div><div class="line">    q_ = dimensionedScalar(<span class="string">"zero"</span>,  dimensionSet(<span class="number">1</span>, <span class="number">0</span>, <span class="number">-3</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="number">0.0</span>);</div><div class="line"></div><div class="line">    fD_ = dimensionedVector</div><div class="line">    (</div><div class="line">        <span class="string">"zero"</span>,</div><div class="line">        dimensionSet(<span class="number">1</span>, <span class="number">-1</span>, <span class="number">-2</span>, <span class="number">0</span>, <span class="number">0</span>),</div><div class="line">        <span class="built_in">vector</span>::zero</div><div class="line">    );</div><div class="line"></div><div class="line">    rhoN_ = dimensionedScalar(<span class="string">"zero"</span>,  dimensionSet(<span class="number">0</span>, <span class="number">-3</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), VSMALL);</div><div class="line">    rhoM_ =  dimensionedScalar(<span class="string">"zero"</span>,  dimensionSet(<span class="number">1</span>, <span class="number">-3</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), VSMALL);</div><div class="line">    dsmcRhoN_ = dimensionedScalar(<span class="string">"zero"</span>,  dimensionSet(<span class="number">0</span>, <span class="number">-3</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="number">0.0</span>);</div><div class="line">    linearKE_ = dimensionedScalar(<span class="string">"zero"</span>,  dimensionSet(<span class="number">1</span>, <span class="number">-1</span>, <span class="number">-2</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="number">0.0</span>);</div><div class="line">    internalE_ = dimensionedScalar(<span class="string">"zero"</span>,  dimensionSet(<span class="number">1</span>, <span class="number">-1</span>, <span class="number">-2</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="number">0.0</span>);</div><div class="line">    iDof_ = dimensionedScalar(<span class="string">"zero"</span>,  dimensionSet(<span class="number">0</span>, <span class="number">-3</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), VSMALL);</div><div class="line">    momentum_ = dimensionedVector</div><div class="line">    (</div><div class="line">        <span class="string">"zero"</span>,</div><div class="line">        dimensionSet(<span class="number">1</span>, <span class="number">-2</span>, <span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>),</div><div class="line">        <span class="built_in">vector</span>::zero</div><div class="line">    );</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>DsmcCloud::calculateFields()</code>: 统计场</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ParcelType&gt;</div><div class="line"><span class="keyword">void</span> Foam::DsmcCloud&lt;ParcelType&gt;::calculateFields()</div><div class="line">&#123;</div><div class="line">    scalarField&amp; rhoN = rhoN_.internalField();</div><div class="line">    scalarField&amp; rhoM = rhoM_.internalField();</div><div class="line">    scalarField&amp; dsmcRhoN = dsmcRhoN_.internalField();</div><div class="line">    scalarField&amp; linearKE = linearKE_.internalField();</div><div class="line">    scalarField&amp; internalE = internalE_.internalField();</div><div class="line">    scalarField&amp; iDof = iDof_.internalField();</div><div class="line">    vectorField&amp; momentum = momentum_.internalField();</div><div class="line"></div><div class="line">    forAllConstIter(<span class="keyword">typename</span> DsmcCloud&lt;ParcelType&gt;, *<span class="keyword">this</span>, iter)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">const</span> ParcelType&amp; p = iter();</div><div class="line">        <span class="keyword">const</span> label cellI = p.cell();</div><div class="line">        rhoN[cellI]++;</div><div class="line">        rhoM[cellI] += constProps(p.typeId()).mass();</div><div class="line">        dsmcRhoN[cellI]++;</div><div class="line">        linearKE[cellI] += <span class="number">0.5</span>*constProps(p.typeId()).mass()*(p.U() &amp; p.U());</div><div class="line">        internalE[cellI] += p.Ei();</div><div class="line">        iDof[cellI] += constProps(p.typeId()).internalDegreesOfFreedom();</div><div class="line">        momentum[cellI] += constProps(p.typeId()).mass()*p.U();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    rhoN *= nParticle_/mesh().cellVolumes();</div><div class="line">    rhoN_.correctBoundaryConditions();</div><div class="line"></div><div class="line">    rhoM *= nParticle_/mesh().cellVolumes();</div><div class="line">    rhoM_.correctBoundaryConditions();</div><div class="line"></div><div class="line">    dsmcRhoN_.correctBoundaryConditions();</div><div class="line"></div><div class="line">    linearKE *= nParticle_/mesh().cellVolumes();</div><div class="line">    linearKE_.correctBoundaryConditions();</div><div class="line"></div><div class="line">    internalE *= nParticle_/mesh().cellVolumes();</div><div class="line">    internalE_.correctBoundaryConditions();</div><div class="line"></div><div class="line">    iDof *= nParticle_/mesh().cellVolumes();</div><div class="line">    iDof_.correctBoundaryConditions();</div><div class="line"></div><div class="line">    momentum *= nParticle_/mesh().cellVolumes();</div><div class="line">    momentum_.correctBoundaryConditions();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>看看<code>DsmcCloud</code>的构造函数，可以发现它主要存储哪些东西：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// * * * * * * * * * * * * * * * * Constructors  * * * * * * * * * * * * * * //</span></div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ParcelType&gt;</div><div class="line">Foam::DsmcCloud&lt;ParcelType&gt;::DsmcCloud</div><div class="line">(</div><div class="line">    <span class="keyword">const</span> word&amp; cloudName,</div><div class="line">    <span class="keyword">const</span> fvMesh&amp; mesh,</div><div class="line">    <span class="keyword">bool</span> readFields</div><div class="line">)</div><div class="line">:</div><div class="line">    Cloud&lt;ParcelType&gt;(mesh, cloudName, <span class="literal">false</span>),</div><div class="line">    DsmcBaseCloud(),</div><div class="line">    cloudName_(cloudName),</div><div class="line">    mesh_(mesh),</div><div class="line">    particleProperties_</div><div class="line">    (</div><div class="line">        IOobject</div><div class="line">        (</div><div class="line">            cloudName + <span class="string">"Properties"</span>,</div><div class="line">            mesh_.time().constant(),</div><div class="line">            mesh_,</div><div class="line">            IOobject::MUST_READ_IF_MODIFIED,</div><div class="line">            IOobject::NO_WRITE</div><div class="line">        )</div><div class="line">    ),</div><div class="line">    typeIdList_(particleProperties_.lookup(<span class="string">"typeIdList"</span>)),</div><div class="line">    nParticle_(readScalar(particleProperties_.lookup(<span class="string">"nEquivalentParticles"</span>))),</div><div class="line">    cellOccupancy_(mesh_.nCells()),</div><div class="line">    sigmaTcRMax_ <span class="comment">//&lt;&lt;------ 这个主要是作为计算的时候用，输出并没有意义。</span></div><div class="line">    (</div><div class="line">        IOobject</div><div class="line">        (</div><div class="line">            <span class="keyword">this</span>-&gt;name() + <span class="string">"SigmaTcRMax"</span>,</div><div class="line">            mesh_.time().timeName(),</div><div class="line">            mesh_,</div><div class="line">            IOobject::MUST_READ,  <span class="comment">//&lt;&lt;------ 这里都是MUST_READ</span></div><div class="line">            IOobject::AUTO_WRITE</div><div class="line">        ),</div><div class="line">        mesh_</div><div class="line">    ),</div><div class="line">    collisionSelectionRemainder_(mesh_.nCells(), <span class="number">0</span>),</div><div class="line">    q_</div><div class="line">    (</div><div class="line">        IOobject</div><div class="line">        (</div><div class="line">            <span class="string">"q"</span>,</div><div class="line">            mesh_.time().timeName(),</div><div class="line">            mesh_,</div><div class="line">            IOobject::MUST_READ,</div><div class="line">            IOobject::AUTO_WRITE</div><div class="line">        ),</div><div class="line">        mesh_</div><div class="line">    ),</div><div class="line">    fD_</div><div class="line">    (</div><div class="line">        IOobject</div><div class="line">        (</div><div class="line">            <span class="string">"fD"</span>,</div><div class="line">            mesh_.time().timeName(),</div><div class="line">            mesh_,</div><div class="line">            IOobject::MUST_READ,</div><div class="line">            IOobject::AUTO_WRITE</div><div class="line">        ),</div><div class="line">        mesh_</div><div class="line">    ),</div><div class="line">    rhoN_</div><div class="line">    (</div><div class="line">        IOobject</div><div class="line">        (</div><div class="line">            <span class="string">"rhoN"</span>,</div><div class="line">            mesh_.time().timeName(),</div><div class="line">            mesh_,</div><div class="line">            IOobject::MUST_READ,</div><div class="line">            IOobject::AUTO_WRITE</div><div class="line">        ),</div><div class="line">        mesh_</div><div class="line">    ),</div><div class="line">    rhoM_</div><div class="line">    (</div><div class="line">        IOobject</div><div class="line">        (</div><div class="line">            <span class="string">"rhoM"</span>,</div><div class="line">            mesh_.time().timeName(),</div><div class="line">            mesh_,</div><div class="line">            IOobject::MUST_READ,</div><div class="line">            IOobject::AUTO_WRITE</div><div class="line">        ),</div><div class="line">        mesh_</div><div class="line">    ),</div><div class="line">    dsmcRhoN_</div><div class="line">    (</div><div class="line">        IOobject</div><div class="line">        (</div><div class="line">            <span class="string">"dsmcRhoN"</span>,</div><div class="line">            mesh_.time().timeName(),</div><div class="line">            mesh_,</div><div class="line">            IOobject::MUST_READ,</div><div class="line">            IOobject::AUTO_WRITE</div><div class="line">        ),</div><div class="line">        mesh_</div><div class="line">    ),</div><div class="line">    linearKE_</div><div class="line">    (</div><div class="line">        IOobject</div><div class="line">        (</div><div class="line">            <span class="string">"linearKE"</span>,</div><div class="line">            mesh_.time().timeName(),</div><div class="line">            mesh_,</div><div class="line">            IOobject::MUST_READ,</div><div class="line">            IOobject::AUTO_WRITE</div><div class="line">        ),</div><div class="line">        mesh_</div><div class="line">    ),</div><div class="line">    internalE_</div><div class="line">    (</div><div class="line">        IOobject</div><div class="line">        (</div><div class="line">            <span class="string">"internalE"</span>,</div><div class="line">            mesh_.time().timeName(),</div><div class="line">            mesh_,</div><div class="line">            IOobject::MUST_READ,</div><div class="line">            IOobject::AUTO_WRITE</div><div class="line">        ),</div><div class="line">        mesh_</div><div class="line">    ),</div><div class="line">    iDof_</div><div class="line">    (</div><div class="line">        IOobject</div><div class="line">        (</div><div class="line">            <span class="string">"iDof"</span>,</div><div class="line">            mesh_.time().timeName(),</div><div class="line">            mesh_,</div><div class="line">            IOobject::MUST_READ,</div><div class="line">            IOobject::AUTO_WRITE</div><div class="line">        ),</div><div class="line">        mesh_</div><div class="line">    ),</div><div class="line">    momentum_</div><div class="line">    (</div><div class="line">        IOobject</div><div class="line">        (</div><div class="line">            <span class="string">"momentum"</span>,</div><div class="line">            mesh_.time().timeName(),</div><div class="line">            mesh_,</div><div class="line">            IOobject::MUST_READ,</div><div class="line">            IOobject::AUTO_WRITE</div><div class="line">        ),</div><div class="line">        mesh_</div><div class="line">    ),</div><div class="line">    constProps_(),</div><div class="line">    rndGen_(label(<span class="number">149382906</span>) + <span class="number">7183</span>*Pstream::myProcNo()),</div><div class="line">    boundaryT_</div><div class="line">    (</div><div class="line">        volScalarField</div><div class="line">        (</div><div class="line">            IOobject</div><div class="line">            (</div><div class="line">                <span class="string">"boundaryT"</span>,</div><div class="line">                mesh_.time().timeName(),</div><div class="line">                mesh_,</div><div class="line">                IOobject::MUST_READ,</div><div class="line">                IOobject::AUTO_WRITE</div><div class="line">            ),</div><div class="line">            mesh_</div><div class="line">        )</div><div class="line">    ),</div><div class="line">    boundaryU_</div><div class="line">    (</div><div class="line">        volVectorField</div><div class="line">        (</div><div class="line">            IOobject</div><div class="line">            (</div><div class="line">                <span class="string">"boundaryU"</span>,</div><div class="line">                mesh_.time().timeName(),</div><div class="line">                mesh_,</div><div class="line">                IOobject::MUST_READ,</div><div class="line">                IOobject::AUTO_WRITE</div><div class="line">            ),</div><div class="line">            mesh_</div><div class="line">        )</div><div class="line">    ),</div><div class="line">    binaryCollisionModel_</div><div class="line">    (</div><div class="line">        BinaryCollisionModel&lt;DsmcCloud&lt;ParcelType&gt; &gt;::New</div><div class="line">        (</div><div class="line">            particleProperties_,</div><div class="line">            *<span class="keyword">this</span></div><div class="line">        )</div><div class="line">    ),</div><div class="line">    wallInteractionModel_</div><div class="line">    (</div><div class="line">        WallInteractionModel&lt;DsmcCloud&lt;ParcelType&gt; &gt;::New</div><div class="line">        (</div><div class="line">            particleProperties_,</div><div class="line">            *<span class="keyword">this</span></div><div class="line">        )</div><div class="line">    ),</div><div class="line">    inflowBoundaryModel_</div><div class="line">    (</div><div class="line">        InflowBoundaryModel&lt;DsmcCloud&lt;ParcelType&gt; &gt;::New</div><div class="line">        (</div><div class="line">            particleProperties_,</div><div class="line">            *<span class="keyword">this</span></div><div class="line">        )</div><div class="line">    )</div><div class="line">&#123;</div><div class="line">    buildConstProps();</div><div class="line"></div><div class="line">    buildCellOccupancy();</div><div class="line"></div><div class="line">    <span class="comment">// Initialise the collision selection remainder to a random value between 0</span></div><div class="line">    <span class="comment">// and 1.</span></div><div class="line">    forAll(collisionSelectionRemainder_, i)</div><div class="line">    &#123;</div><div class="line">        collisionSelectionRemainder_[i] = rndGen_.scalar01();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (readFields)</div><div class="line">    &#123;</div><div class="line">        ParcelType::readFields(*<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以发现<code>DsmcCloud</code>的演化过程十分清晰明了。就是内部记录了一些extensive fields，和 particle的位置、速度。然后每个演化步统计这些 extensive fields，然后执行迁移和碰撞，边界处理。这些extensive fields完全由新时刻的particle速度计算出来。</p>
<h4 id="fieldAverage-分析"><a href="#fieldAverage-分析" class="headerlink" title="fieldAverage 分析"></a>fieldAverage 分析</h4><p>在一个dsmcFoam的case里面，<code>controlDict</code> 文件里面要设置在求解过程中输出一些时间平均的场, 这由OpenFOAM本身提供的<code>fieldAverage</code> 和dsmcFOAM提供的<code>dsmcField</code> 这两个<a href="http://cfd.direct/openfoam/user-guide/function-objects/" target="_blank" rel="external">Function object</a>来完成。</p>
<p><strong>NOTE</strong>: 关于<code>fieldAverage</code> Function object到底是怎样进行时间平均的， <a href="http://xiaopingqiu.github.io/2015/04/12/fieldAverage/" target="_blank" rel="external">这篇博文</a>有很好的分析。</p>
<p>下面这个例子是一个dsmcFoam case里<code>controlDict</code>文件的<code>functions</code>部分:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">functions <span class="comment">// 这里面是设置了两个时间平均计算，一个是fieldAverage1，另一个是dsmcFields1</span></div><div class="line">&#123;</div><div class="line">    fieldAverage1</div><div class="line">    &#123;</div><div class="line">        type            fieldAverage; <span class="comment">//&lt;&lt;------ 这个是OpenFOAM本身提供的。</span></div><div class="line">        functionObjectLibs ( <span class="string">"libfieldFunctionObjects.so"</span> );</div><div class="line">        outputControl   outputTime; <span class="comment">//&lt;&lt;------  随着每次dsmcFoam输出AUTO_WRITE属性的</span></div><div class="line">                                    <span class="comment">//场（由controlDict里面的writeControl控制）</span></div><div class="line">                                    <span class="comment">//的时候都会输出这些时均场。</span></div><div class="line">        resetOnOutput   <span class="literal">false</span>;</div><div class="line"></div><div class="line">        fields</div><div class="line">        (</div><div class="line">            rhoN</div><div class="line">            &#123;</div><div class="line">                mean        on;</div><div class="line">                prime2Mean  off;</div><div class="line">                base        time; <span class="comment">// 如果base设为time的话，每个演化步都会计算一次时均</span></div><div class="line">                <span class="comment">//windows    2;   //窗口长度为2，就是相对于没有windows,统计频率会降低一倍。</span></div><div class="line">            &#125;</div><div class="line">            rhoM</div><div class="line">            &#123;</div><div class="line">                mean        on;</div><div class="line">                prime2Mean  off;</div><div class="line">                base        time;</div><div class="line">            &#125;</div><div class="line">            ... <span class="comment">//省略</span></div><div class="line">            fD</div><div class="line">            &#123;</div><div class="line">                mean        on;</div><div class="line">                prime2Mean  off;</div><div class="line">                base        time;</div><div class="line">            &#125;</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">    dsmcFields1</div><div class="line">    &#123;</div><div class="line">        type            dsmcFields;</div><div class="line">        functionObjectLibs ( <span class="string">"libutilityFunctionObjects.so"</span> );</div><div class="line">        enabled         <span class="literal">true</span>;</div><div class="line">        outputControl   outputTime;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里面设置每个需要计算时均值的场的设置。包括<code>mean</code>,<code>prome2Mean</code>,<code>base</code>,<code>window</code>。时均场输出的文件名后面会多一个<em>Mean</em>。 如momentum的时均场为momentumMean。</p>
<p>上面的设置中<code>base</code>为<code>time</code>，发现计算过程中每个演化步(<code>DsmcCloud::evolve()</code>)都计算了时均场，log里面每个演化都会出现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">fieldAverage fieldAverage1 output:</div><div class="line">    Calculating averages</div></pre></td></tr></table></figure>
<ul>
<li>如果不设置<code>window</code> : 每次计算的时均场都是从<strong>求解开始到目前所有步</strong>的时均场。</li>
<li>如果设置了<code>window</code> :  <blockquote><p>base用来指定作时间平均的基础，是基于时间步数(ITER)还是物理时间(time);  window用来作平均的时间段的长度，如果不设定，则求的是从开始到当前时间这个时间段的平均值。window的数值的实际含义依base而定，如果base是ITER，则window=20表示当前步及其前 19 个时间步从 20 个时间步内的平均，而如果base是time,则表示的是 20s 内的平均。</p>
</blockquote>
</li>
</ul>
<p>在输出数据文件时（每evolve 100次）还会输出<code>fieldAverage1</code>设置的时均场(<code>writing average fields</code>)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">fieldAverage fieldAverage1 output:</div><div class="line">    Calculating averages</div><div class="line">    writing average fields //&lt;------ 表示输出时均场</div><div class="line"></div><div class="line">Calculating dsmcFields.</div><div class="line">    Calculating UMean field.</div><div class="line">    Calculating translationalT field.</div><div class="line">    Calculating internalT field.</div><div class="line">    Calculating overallT field.</div><div class="line">    Calculating pressure field.</div><div class="line">    mag(UMean) max/min : 76.50092418551631 1.282028354585403</div><div class="line">    translationalT max/min : 436.5786449656766 219.0809500397843</div><div class="line">    internalT max/min : 0 0</div><div class="line">    overallT max/min : 436.5786449656766 219.0809500397843</div><div class="line">    p max/min : 67296.44015303567 42358.60866053814</div><div class="line">dsmcFields written.</div></pre></td></tr></table></figure>
<p><strong>NOTE</strong>: 可以发现在<code>writing average fields</code>的时候<code>dsmcFields</code> function object被触发了，它计算<code>UMean</code>,<code>translationalT</code>,<code>internalT</code>,<code>overallT</code>,<code>pressure</code>等场。</p>
<p>可以定义两个开关分别是<code>resetOnOutput</code>和<code>resetOnRestart</code>, 其意义是：</p>
<blockquote>
<p>resetOnRestart的值决定当solver继续运行时，是否要读取最近一个时间步的meanField的值来计算接下来时刻的时均值；&gt;resetOnOutput，顾名思义，是否要在每一次输出到文件以后重置meanField的值。这两个开关的默认值都是false。”</p>
</blockquote>
<p>这里可能有个疑问，如果不做这两个时均计算会怎样？会不会影响计算过程？毕竟dsmc的计算过程不依赖于这些宏观量场以及它们的时均场。这个疑问是很自然的。可以通过一个例子分析一下：<br>如果在<code>controlDict</code>文件里面如下设置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">startTime       0;</div><div class="line">stopAt          endTime;</div><div class="line">endTime         1e-8;</div><div class="line">deltaT          1e-11;</div><div class="line">writeControl    timeStep;</div><div class="line">writeInterval   100;</div></pre></td></tr></table></figure>
<p>表示计算1000步，每100步输出。</p>
<ol>
<li>如果我们再注释掉<code>functions</code>部分, 也就是不求平均。运行dsmcFoam，也没有问题，不会报错。运行完会产生10个数据文件目录（1000/100=10）。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[lhzhu@ws3 dsmc1]$ ls</div><div class="line">0  1e-08  1e-09  2e-09  3e-09  4e-09  5e-09  6e-09  7e-09  8e-09  9e-09  constant  log  PyFoamHistory  system</div></pre></td></tr></table></figure>
<p>每个目录里面只有当前步的统计出来的场(非时均)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[lhzhu@ws3 dsmc1]$ ls 1e-09</div><div class="line">boundaryT  boundaryU  dsmcRhoN  dsmcSigmaTcRMax  fD  iDof  internalE  lagrangian  linearKE  momentum  q  rhoM  rhoN  uniform</div></pre></td></tr></table></figure>
<ol>
<li>但是如果我们如果只注释掉<code>functions</code>里面的<code>fieldAverage1</code>部分，或者只去掉 <code>fieldAverage1</code>里面的任何一个时均场，则会报错。比如去掉<code>fD</code>的时均计算，会有Fatal Error如下：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">--&gt; FOAM FATAL ERROR:</div><div class="line">    request for volVectorField fDMean from objectRegistry region0 failed</div></pre></td></tr></table></figure>
<p>这个错误应该是在执行<code>dsmcFields</code> function object 时产生的。下面我们分析<code>dsmcFields</code>。</p>
<h4 id="dsmcFields分析"><a href="#dsmcFields分析" class="headerlink" title="dsmcFields分析"></a>dsmcFields分析</h4><p>源文件位置： <a href="https://github.com/OpenFOAM/OpenFOAM-2.3.x/tree/master/src/postProcessing/functionObjects/utilities/dsmcFields" target="_blank" rel="external">https://github.com/OpenFOAM/OpenFOAM-2.3.x/tree/master/src/postProcessing/functionObjects/utilities/dsmcFields</a></p>
<p><code>dsmcFields.H</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Description</div><div class="line">    Calculate intensive fields:</div><div class="line">    - UMean</div><div class="line">    - translationalT</div><div class="line">    - internalT</div><div class="line">    - overallT</div><div class="line">    from averaged extensive fields from a DSMC calculation.</div><div class="line">SourceFiles</div><div class="line">    dsmcFields.C</div><div class="line">    IOdsmcFields.H</div></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">class</span> dsmcFields</div><div class="line">&#123;</div><div class="line">    <span class="comment">// Private data</span></div><div class="line"></div><div class="line">        <span class="comment">//- Name of this set of dsmcFields objects</span></div><div class="line">        word name_;</div><div class="line"></div><div class="line">        <span class="keyword">const</span> objectRegistry&amp; obr_;</div><div class="line"></div><div class="line">        <span class="comment">//- on/off switch</span></div><div class="line">        <span class="keyword">bool</span> active_;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// Private Member Functions</span></div><div class="line"></div><div class="line">        <span class="comment">//- Disallow default bitwise copy construct</span></div><div class="line">        dsmcFields(<span class="keyword">const</span> dsmcFields&amp;);</div><div class="line"></div><div class="line">        <span class="comment">//- Disallow default bitwise assignment</span></div><div class="line">        <span class="keyword">void</span> <span class="keyword">operator</span>=(<span class="keyword">const</span> dsmcFields&amp;);</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">public</span>:</div><div class="line"></div><div class="line">    <span class="comment">//- Runtime type information</span></div><div class="line">    TypeName(<span class="string">"dsmcFields"</span>);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// Constructors</span></div><div class="line"></div><div class="line">        <span class="comment">//- Construct for given objectRegistry and dictionary.</span></div><div class="line">        <span class="comment">//  Allow the possibility to load fields from files</span></div><div class="line">        dsmcFields</div><div class="line">        (</div><div class="line">            <span class="keyword">const</span> word&amp; name,</div><div class="line">            <span class="keyword">const</span> objectRegistry&amp;,</div><div class="line">            <span class="keyword">const</span> dictionary&amp;,</div><div class="line">            <span class="keyword">const</span> <span class="keyword">bool</span> loadFromFiles = <span class="literal">false</span></div><div class="line">        );</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">//- Destructor</span></div><div class="line">    <span class="keyword">virtual</span> ~dsmcFields();</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// Member Functions</span></div><div class="line"></div><div class="line">        <span class="comment">//- Return name of the set of dsmcFields</span></div><div class="line">        <span class="function"><span class="keyword">virtual</span> <span class="keyword">const</span> word&amp; <span class="title">name</span><span class="params">()</span> <span class="keyword">const</span></span></div><div class="line">        &#123;</div><div class="line">            <span class="keyword">return</span> name_;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//- Read the dsmcFields data</span></div><div class="line">        <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">const</span> dictionary&amp;)</span></span>;</div><div class="line"></div><div class="line">        <span class="comment">//- Execute, currently does nothing</span></div><div class="line">        <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">        <span class="comment">//- Execute at the final time-loop, currently does nothing</span></div><div class="line">        <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">end</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">        <span class="comment">//- Called when time was set at the end of the Time::operator++</span></div><div class="line">        <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">timeSet</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">        <span class="comment">//- Calculate the dsmcFields and write</span></div><div class="line">        <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">()</span></span>; <span class="comment">//&lt;------ 最重要的是这个函数</span></div><div class="line"></div><div class="line">        <span class="comment">//- Update for changes of mesh</span></div><div class="line">        <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">updateMesh</span><span class="params">(<span class="keyword">const</span> mapPolyMesh&amp;)</span></span></div><div class="line">        &#123;&#125;</div><div class="line"></div><div class="line">        <span class="comment">//- Update for changes of mesh</span></div><div class="line">        <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">movePoints</span><span class="params">(<span class="keyword">const</span> polyMesh&amp;)</span></span></div><div class="line">        &#123;&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p><code>dsmcFields::write()</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div></pre></td><td class="code"><pre><div class="line">void Foam::dsmcFields::write()</div><div class="line">&#123;</div><div class="line">    if (active_)</div><div class="line">    &#123;</div><div class="line">        word rhoNMeanName = "rhoNMean";</div><div class="line">        word rhoMMeanName = "rhoMMean";</div><div class="line">        word momentumMeanName = "momentumMean";</div><div class="line">        word linearKEMeanName = "linearKEMean";</div><div class="line">        word internalEMeanName = "internalEMean";</div><div class="line">        word iDofMeanName = "iDofMean";</div><div class="line">        word fDMeanName = "fDMean";</div><div class="line"></div><div class="line">        const volScalarField&amp; rhoNMean = obr_.lookupObject&lt;volScalarField&gt;</div><div class="line">        (</div><div class="line">            rhoNMeanName</div><div class="line">        );</div><div class="line"></div><div class="line">        const volScalarField&amp; rhoMMean = obr_.lookupObject&lt;volScalarField&gt;</div><div class="line">        (</div><div class="line">            rhoMMeanName</div><div class="line">        );</div><div class="line"></div><div class="line">        const volVectorField&amp; momentumMean = obr_.lookupObject&lt;volVectorField&gt;</div><div class="line">        (</div><div class="line">            momentumMeanName</div><div class="line">        );</div><div class="line"></div><div class="line">        const volScalarField&amp; linearKEMean = obr_.lookupObject&lt;volScalarField&gt;</div><div class="line">        (</div><div class="line">            linearKEMeanName</div><div class="line">        );</div><div class="line"></div><div class="line">        const volScalarField&amp; internalEMean = obr_.lookupObject&lt;volScalarField&gt;</div><div class="line">        (</div><div class="line">            internalEMeanName</div><div class="line">        );</div><div class="line"></div><div class="line">        const volScalarField&amp; iDofMean = obr_.lookupObject&lt;volScalarField&gt;</div><div class="line">        (</div><div class="line">            iDofMeanName</div><div class="line">        );</div><div class="line"></div><div class="line">        const volVectorField&amp; fDMean = obr_.lookupObject&lt;volVectorField&gt;</div><div class="line">        (</div><div class="line">            fDMeanName</div><div class="line">        );</div><div class="line"></div><div class="line">        if (min(mag(rhoNMean)).value() &gt; VSMALL)</div><div class="line">        &#123;</div><div class="line">            Info&lt;&lt; "Calculating dsmcFields." &lt;&lt; endl;</div><div class="line"></div><div class="line">            Info&lt;&lt; "    Calculating UMean field." &lt;&lt; endl;</div><div class="line">            volVectorField UMean</div><div class="line">            (</div><div class="line">                IOobject</div><div class="line">                (</div><div class="line">                    "UMean",</div><div class="line">                    obr_.time().timeName(),</div><div class="line">                    obr_,</div><div class="line">                    IOobject::NO_READ</div><div class="line">                ),</div><div class="line">                momentumMean/rhoMMean</div><div class="line">            );</div><div class="line"></div><div class="line">            Info&lt;&lt; "    Calculating translationalT field." &lt;&lt; endl;</div><div class="line">            volScalarField translationalT</div><div class="line">            (</div><div class="line">                IOobject</div><div class="line">                (</div><div class="line">                    "translationalT",</div><div class="line">                    obr_.time().timeName(),</div><div class="line">                    obr_,</div><div class="line">                    IOobject::NO_READ</div><div class="line">                ),</div><div class="line"></div><div class="line">                2.0/(3.0*physicoChemical::k.value()*rhoNMean)</div><div class="line">               *(linearKEMean - 0.5*rhoMMean*(UMean &amp; UMean))</div><div class="line">            );</div><div class="line"></div><div class="line">            Info&lt;&lt; "    Calculating internalT field." &lt;&lt; endl;</div><div class="line">            volScalarField internalT</div><div class="line">            (</div><div class="line">                IOobject</div><div class="line">                (</div><div class="line">                    "internalT",</div><div class="line">                    obr_.time().timeName(),</div><div class="line">                    obr_,</div><div class="line">                    IOobject::NO_READ</div><div class="line">                ),</div><div class="line">                (2.0/physicoChemical::k.value())*(internalEMean/iDofMean)</div><div class="line">            );</div><div class="line"></div><div class="line">            Info&lt;&lt; "    Calculating overallT field." &lt;&lt; endl;</div><div class="line">            volScalarField overallT</div><div class="line">            (</div><div class="line">                IOobject</div><div class="line">                (</div><div class="line">                    "overallT",</div><div class="line">                    obr_.time().timeName(),</div><div class="line">                    obr_,</div><div class="line">                    IOobject::NO_READ</div><div class="line">                ),</div><div class="line">                2.0/(physicoChemical::k.value()*(3.0*rhoNMean + iDofMean))</div><div class="line">               *(linearKEMean - 0.5*rhoMMean*(UMean &amp; UMean) + internalEMean)</div><div class="line">            );</div><div class="line"></div><div class="line">            Info&lt;&lt; "    Calculating pressure field." &lt;&lt; endl;</div><div class="line">            volScalarField p</div><div class="line">            (</div><div class="line">                IOobject</div><div class="line">                (</div><div class="line">                    "p",</div><div class="line">                    obr_.time().timeName(),</div><div class="line">                    obr_,</div><div class="line">                    IOobject::NO_READ</div><div class="line">                ),</div><div class="line">                physicoChemical::k.value()*rhoNMean*translationalT</div><div class="line">            );</div><div class="line"></div><div class="line">            const fvMesh&amp; mesh = fDMean.mesh();</div><div class="line"></div><div class="line">            forAll(mesh.boundaryMesh(), i)</div><div class="line">            &#123;</div><div class="line">                const polyPatch&amp; patch = mesh.boundaryMesh()[i];</div><div class="line"></div><div class="line">                if (isA&lt;wallPolyPatch&gt;(patch))</div><div class="line">                &#123;</div><div class="line">                    p.boundaryField()[i] =</div><div class="line">                        fDMean.boundaryField()[i]</div><div class="line">                      &amp; (patch.faceAreas()/mag(patch.faceAreas()));</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            Info&lt;&lt; "    mag(UMean) max/min : "</div><div class="line">                &lt;&lt; max(mag(UMean)).value() &lt;&lt; " "</div><div class="line">                &lt;&lt; min(mag(UMean)).value() &lt;&lt; endl;</div><div class="line"></div><div class="line">            Info&lt;&lt; "    translationalT max/min : "</div><div class="line">                &lt;&lt; max(translationalT).value() &lt;&lt; " "</div><div class="line">                &lt;&lt; min(translationalT).value() &lt;&lt; endl;</div><div class="line"></div><div class="line">            Info&lt;&lt; "    internalT max/min : "</div><div class="line">                &lt;&lt; max(internalT).value() &lt;&lt; " "</div><div class="line">                &lt;&lt; min(internalT).value() &lt;&lt; endl;</div><div class="line"></div><div class="line">            Info&lt;&lt; "    overallT max/min : "</div><div class="line">                &lt;&lt; max(overallT).value() &lt;&lt; " "</div><div class="line">                &lt;&lt; min(overallT).value() &lt;&lt; endl;</div><div class="line"></div><div class="line">            Info&lt;&lt; "    p max/min : "</div><div class="line">                &lt;&lt; max(p).value() &lt;&lt; " "</div><div class="line">                &lt;&lt; min(p).value() &lt;&lt; endl;</div><div class="line"></div><div class="line">            UMean.write();</div><div class="line"></div><div class="line">            translationalT.write();</div><div class="line"></div><div class="line">            internalT.write();</div><div class="line"></div><div class="line">            overallT.write();</div><div class="line"></div><div class="line">            p.write();</div><div class="line"></div><div class="line">            Info&lt;&lt; "dsmcFields written." &lt;&lt; nl &lt;&lt; endl;</div><div class="line">        &#125;</div><div class="line">        else</div><div class="line">        &#123;</div><div class="line">            Info&lt;&lt; "Small value (" &lt;&lt; min(mag(rhoNMean))</div><div class="line">                &lt;&lt; ") found in rhoNMean field. "</div><div class="line">                &lt;&lt; "Not calculating dsmcFields to avoid division by zero."</div><div class="line">                &lt;&lt; endl;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>明显可以发现<code>dsmcFields</code>所做的只是根据<code>fieldAverage1</code>输出的时均场来求出其他时均场，例如根据时均密度场和时均动量场来求出时均速度场。这个工作也可以由后处理工具<code>dsmcFieldsCalc</code>完成，而不是写成<code>controlDict</code>里面的function object。</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>综上分析，有以下总结：</p>
<ul>
<li>用<code>fieldAverage</code>对宏观量场求时均是dsmcFoam里面输出宏观量场的最重要步骤。</li>
<li><code>window</code>控制对那一段时间求平均。如果不设置<code>window</code>就是从开始到当前所有步的平均。<br>如果设置<code>window</code>, 结合<code>base</code>  (<code>ITER</code>/<code>time</code>)，可以设置 从当前时间/步 往前多少s/步 求时均值。</li>
<li><code>dsmcFields</code> 辅助计算其他时均场如 <code>UMean</code>, <code>overallT</code>等等，它只是对<code>fieldAverage</code>输出的时均场做简单的加减乘除计算。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/10/07/of-dsmcFoam/" data-id="ciu15g4kc0005zcuxpaym94ko" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OpenFOAM/">OpenFOAM</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-of-fvMesh" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/10/06/of-fvMesh/" class="article-date">
  <time datetime="2016-10-06T13:11:04.000Z" itemprop="datePublished">2016-10-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/06/of-fvMesh/">OpenFOAM里面的网格对象（fvMesh）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>上次讲到了Time对象，并介绍了我们的程序如何跟<code>system/controlDict</code>文件关联。这次我们介绍程序如何读取网格、网格文件在OpenFOAM里面如何表示、以及如何获取网格信息。</p>
<h2 id="程序如何读取网格"><a href="#程序如何读取网格" class="headerlink" title="程序如何读取网格"></a>程序如何读取网格</h2><p>上次介绍<code>setTime.H</code>时提到过，程序读取网格是通过在main函数开头用包含<code>createMesh.H</code>文件来实现的。 现在我们改动我们的HelloWorld程序，包含这个头文件，如下<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></div><div class="line">&#123;</div><div class="line">    <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"setRootCase.H"</span></span></div><div class="line">    <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"createTime.H"</span></span></div><div class="line">    <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"createMesh.H"</span></span></div><div class="line">    ...</div></pre></td></tr></table></figure></p>
<p><code>createMesh.H</code>文件位于<code>$FOAM_SRC/OpenFOAM/include/</code>。 我们可以看看其内容是<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">// createMesh.H</div><div class="line">// ~~~~~~~~~~~~</div><div class="line"></div><div class="line">    Foam::Info</div><div class="line">        &lt;&lt; "Create mesh for time = "</div><div class="line">        &lt;&lt; runTime.timeName() &lt;&lt; Foam::nl &lt;&lt; Foam::endl;</div><div class="line"></div><div class="line">    Foam::fvMesh mesh</div><div class="line">    (</div><div class="line">        Foam::IOobject</div><div class="line">        (</div><div class="line">            Foam::fvMesh::defaultRegion,</div><div class="line">            runTime.timeName(),</div><div class="line">            runTime,</div><div class="line">            Foam::IOobject::MUST_READ</div><div class="line">        )</div><div class="line">    );</div></pre></td></tr></table></figure></p>
<p>可以发现其实是创建了一个fvMesh对象，叫做mesh。 创建这个fvMesh对象的时候程序读取了<code>constant/polyMesh/</code>目录下面的<br><code>points</code>、<code>faces</code>、<code>owner</code>、<code>neighbour</code>和<code>boundary</code>这5个文件。这5个文件就是OpenFOAM存储网格的文件。它们可以用blockMesh生成，也可以用前处理工具从其他格式的网格文件转换得到（比如用fluentMeshtoFoam、gmshToFoam等等）。 有了这个对象，我们就可以从这个对象获得网格的所有信息（如cell center的坐标、cell的体积等等），这些信息在创建fvMesh对象时，其构造函数就以自动计算好了。</p>
<p>下面举个例子，看看如何获得每个cell 的体积。 简单起见，首先我们准备好一个简单的网格，直接从官方教程的cavity case里面复制blockMeshDict到我们之间创建的HelloWorld case过来：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> <span class="variable">$FOAM_RUN</span>/HelloWorld    <span class="comment">#进入之前我们创建的helloWorld case目录</span></div><div class="line">mkdir -p constant/polyMesh <span class="comment">#先创建这个目录</span></div><div class="line">cp <span class="variable">$FOAM_TUTORIALS</span>/incompressible/icoFoam/cavity/constant/polyMesh/blockMeshDict  constant/polyMesh/blockMeshDict <span class="comment">#复制blockMeshDict</span></div></pre></td></tr></table></figure></p>
<p>修改constant/polyMesh/blockMeshDict文件，把cell个数改为为（2 2 1），也就是X、Y方向各两个cell，Z方向一个cell， 并且把<code>convertToMeters</code>改成1。 如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">convertToMeters 1; //改动</div><div class="line"></div><div class="line">vertices</div><div class="line">(</div><div class="line">    (0 0 0)</div><div class="line">    (1 0 0)</div><div class="line">    (1 1 0)</div><div class="line">    (0 1 0)</div><div class="line">    (0 0 0.1)</div><div class="line">    (1 0 0.1)</div><div class="line">    (1 1 0.1)</div><div class="line">    (0 1 0.1)</div><div class="line">);</div><div class="line"></div><div class="line">blocks</div><div class="line">(</div><div class="line">    hex (0 1 2 3 4 5 6 7) (2 2 1) simpleGrading (1 1 1) //改动</div><div class="line">);</div><div class="line">...</div></pre></td></tr></table></figure>
<p>使用<code>blockMesh</code>生成网格。现在constant/polyMesh目录下面就有那5个表示网格的文件了。 </p>
<p>接下来还要准备<code>system/fvSchemes</code>文件和<code>system/fvSolutions</code>文件, 即使它们里面是空的，因为fvMesh的构造函数必须读取这两个文件。这里我们用的这两个文件内容(除去头部和尾部)分别是：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">$ cat system/fvSchemes</div><div class="line">...</div><div class="line">gradSchemes</div><div class="line">&#123;</div><div class="line">    default         none;</div><div class="line">&#125;</div><div class="line"></div><div class="line">divSchemes</div><div class="line">&#123;</div><div class="line">    default         none;</div><div class="line">&#125;</div><div class="line"></div><div class="line">laplacianSchemes</div><div class="line">&#123;</div><div class="line">    default         none;</div><div class="line">&#125;</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>和<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">solvers</div><div class="line">&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这已经是程序能初始化mesh所需要的最少的信息了，少了任何一条都不行。</p>
<p>现在我们在HelloWorld程序里面增加如下几行代码，来输出每个cell的体积：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"fvCFD.H"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"MyLib.H"</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></div><div class="line">&#123;</div><div class="line">    <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"setRootCase.H"</span></span></div><div class="line">    <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"createTime.H"</span></span></div><div class="line">    <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"createMesh.H"</span></span></div><div class="line"></div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="comment">// mesh info</span></div><div class="line">    <span class="keyword">const</span> scalarField&amp; V = mesh.V(); <span class="comment">// cell volume</span></div><div class="line">    forAll(V, i) <span class="comment">// forAll是OpenFOAM提供的对容器类循环的宏</span></div><div class="line">    &#123;</div><div class="line">        Info &lt;&lt; <span class="string">"Volume of cell # "</span> &lt;&lt; i &lt;&lt; <span class="string">":  "</span> &lt;&lt; V[i] &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这里的<code>const scalarField&amp; V = mesh.V()</code>就是获取mesh对象的所有cell体积，给一个scalarFiled类型的引用。scalrField其实是通过<code>typedef Field&lt;scalar&gt;</code>得到的, 这里初略的理解为一个标量元素的数组，并且可以用<code>[]</code>操作符取元素就够了。（Field&lt;&gt;只是OpenFOAM众多层次的容器类的一层）。 </p>
<p>重新wmake编译，运行输出如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">Volume of cell # 0:  0.025</div><div class="line">Volume of cell # 1:  0.025</div><div class="line">Volume of cell # 2:  0.025</div><div class="line">Volume of cell # 3:  0.025</div></pre></td></tr></table></figure></p>
<p>可以发现每个cell的体积都是<code>(1/2)*(1/2)*0.1 = 0.025</code>。</p>
<p>类似的，还可以获取cell center坐标、face center坐标、face的法向量和面积等几何信息，如下：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">   <span class="keyword">const</span> vectorField&amp; C = mesh.C(); <span class="comment">// cell center coordinate</span></div><div class="line">   forAll(C, i)</div><div class="line">   &#123;</div><div class="line">       Info &lt;&lt; <span class="string">"Center of cell # "</span> &lt;&lt; i &lt;&lt; <span class="string">":  "</span> &lt;&lt; C[i] &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">const</span> vectorField&amp; Cf = mesh.Cf(); <span class="comment">// face center coordinate</span></div><div class="line">   forAll(Cf, i)</div><div class="line">   &#123;</div><div class="line">       Info &lt;&lt; <span class="string">"Center of face # "</span> &lt;&lt; i &lt;&lt; <span class="string">":  "</span> &lt;&lt; Cf[i] &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">const</span> vectorField&amp; Sf = mesh.Sf(); <span class="comment">// face normal</span></div><div class="line">   forAll(Sf, i)</div><div class="line">   &#123;</div><div class="line">       Info &lt;&lt; <span class="string">"Normal of internal face # "</span> &lt;&lt; i &lt;&lt; <span class="string">":  "</span> &lt;&lt; Sf[i] &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">   &#125;</div><div class="line">   ...</div></pre></td></tr></table></figure></p>
<p>下面这个表格列出了获取网格的一些基本几何信息的函数：<br><img src="/images/fvMeshData.png" alt=""></p>
<p>我们暂时先在这里停住，在最后一节再演示如何获取网格的其他信息（数据信息和拓扑信息）。 接下来我们看看任意非结构网格在OpenFOAM内部是如何表示的。</p>
<h2 id="网格在OpenFOAM里面如何表示"><a href="#网格在OpenFOAM里面如何表示" class="headerlink" title="网格在OpenFOAM里面如何表示"></a>网格在OpenFOAM里面如何表示</h2><p>我们开始以刚才的<code>2*2*1</code>的网格为例来说明。 <code>constant/polyMesh</code>目录下面的5个文件内容分布是：</p>
<ul>
<li><code>points</code> : 记录所有的网格顶点，每个点都是由三个分量组成的（三维空间坐标）。 本例中一共有<code>3*3*2</code> = 18个点。</li>
<li><code>faces</code>  : 记录所有的face和组成每个face的顶点编号（就是出现在<code>points</code>里面所有顶点中的次序）。对于本例，一共有20个face，包含了内部face （internal face）和位于边界上的face（boundary face）。 </li>
<li><code>boundary</code>: 记录每个boundary patch的信息，包括patch的名字，类型、所包含的face的个数n，以及这些face在所有face中的开始位置（也就是此patch中第一个face出现在<code>face</code>记录的face列表里面的次序）。 每个boundary patch中的face编号在<code>faces</code>中是连续的。 <code>faces</code> 中开头记录的face是internal face。下图展示的是之前例子中的boundary和face：</li>
</ul>
<p><img src="/images/of_mesh_faces.png" alt=""><br>这里有4个internal face和3个boundary patch，分别是， movingWall（2个face）， fixedWall（6个face）， frontAandBack（8个face）。</p>
<p>在介绍剩下的两个文件<code>owner</code>和<code>neighbour</code>之前，有必要介绍OpenFOAM网格里面的face的owner和neighbour的概念。 无论网格多么复杂，有一个基本特点或者说是要求是： 除了boundary face外的每个face （也就是internal face） 被且仅被两个cell共享。这两个cell分别称为这个face的owner cell和neighbour cell。 规定这个这个face的法向量从owner指向neighbour。 boundary face也有owner cell，但是没有neighbour cell，因为boundary face的法向量指向了计算区域外部，那里没有cell了。现在再看<code>owner</code>和<code>neighbour</code>文件就简单了：</p>
<ul>
<li><code>owner</code>文件记录了一个整型数组，第i个元素表示第i个face(<strong>包括boundary face</strong>)的owner cell的在所有cell中的编号(cell ID)，数组大小等于所有face的个数（本例是20）。</li>
<li><code>neighbour</code>文件记录了一个整型数组，第i个元素表示第i个<strong>internal face</strong>的neighbour cell的在所有cell中的编号(cell ID)，数组大小等于所有internal face的个数（本例是4）。</li>
</ul>
<h2 id="获取网格信息"><a href="#获取网格信息" class="headerlink" title="获取网格信息"></a>获取网格信息</h2><p>之前我们介绍了如何通过<code>V()</code>、<code>C()</code>、<code>Cf()</code>等函数获取一些基本的几何信息，现在我们看如何怎样获取一个face的owner cellID和neighbour cellID。直接看代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// find owner cell and neighbour cell of internal faces</span></div><div class="line"><span class="keyword">const</span> labelUList&amp; owner = mesh.owner(); <span class="comment">// labelUList是一个存贮label的容器。</span></div><div class="line"><span class="keyword">const</span> labelUList&amp; neighbour = mesh.neighbour();</div><div class="line"><span class="comment">// loop over ONLY internal face to find owner and neighbour</span></div><div class="line">forAll(owner, facei) <span class="comment">//注意这里的owner只存了internal face的owner cellID</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">const</span> label own = owner[facei];</div><div class="line">    <span class="keyword">const</span> label nei = neighbour[facei];</div><div class="line">    Info &lt;&lt; <span class="string">"face # "</span> &lt;&lt; facei &lt;&lt; <span class="string">"'s own: "</span> &lt;&lt; own</div><div class="line">        &lt;&lt; <span class="string">", nei: "</span> &lt;&lt; nei &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这段代码输出的是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">face # 0&apos;s own: 0, nei: 1</div><div class="line">face # 1&apos;s own: 0, nei: 2</div><div class="line">face # 2&apos;s own: 1, nei: 3</div><div class="line">face # 3&apos;s own: 2, nei: 3</div></pre></td></tr></table></figure></p>
<p>现在我们可以验证一下到底是不是这样的， 通过刚刚介绍的<code>C()</code>、    <code>Cf()</code>、<code>Sf()</code>函数输出的位置等信息，我们可以找到每个cell和face的编号以及每个face的法向量如下：</p>
<p><img src="/images/of_mesh_cellfaceid.png" alt=""><br>对比刚刚输出的结果可以发现确实是这样。</p>
<p>回到刚才插入的代码，可以发现 <code>fvMesh.owner()</code>和 <code>fvMesh.neighbour()</code>函数可以获取与每个internal face的owner cellID和neighbour cellID。注意这里的<code>owner()</code>返回的数组不包含boundary face的cell ID，这也可以从上例中<code>forAll(owner, facei)</code>只循环4次（4个internal face）可以看出。 </p>
<p>那要怎么知道每个boundary face的owner cellID （也就跟这个bounary face相邻的那个cell的编号）呢，毕竟这个信息在处理边界时必须知道。 下面这段代码就是答案</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// loop over boundary faces, except empty boundaries</span></div><div class="line">forAll(mesh.boundary(), patchi) <span class="comment">//这里对每个bounary patch循环，mesh.boundary()返回boundary patch的数组，不包含empty类型的boundary patch。</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">const</span> labelUList&amp; pOwner = mesh.boundary()[patchi].faceCells(); <span class="comment">// faceCell函数</span></div><div class="line">    forAll(pOwner, facei)</div><div class="line">    &#123;</div><div class="line">        Info &lt;&lt; <span class="string">"Boundary patch #"</span> &lt;&lt; patchi</div><div class="line">            &lt;&lt; <span class="string">"'s face "</span> &lt;&lt; <span class="string">"#"</span> &lt;&lt; facei &lt;&lt; <span class="string">"'s owner cell : "</span></div><div class="line">            &lt;&lt;  pOwner[facei] &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里是打印出了每个boundary patch的每个face的onwer cellID，所以有两层forAll循环。 boundary patch的所有face的owner cellID数组是通过faceCells()函数获取的。<br>这段代码的输出是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Boundary patch #0&apos;s face #0&apos;s owner cell : 2</div><div class="line">Boundary patch #0&apos;s face #1&apos;s owner cell : 3</div><div class="line">Boundary patch #1&apos;s face #0&apos;s owner cell : 0</div><div class="line">Boundary patch #1&apos;s face #1&apos;s owner cell : 2</div><div class="line">Boundary patch #1&apos;s face #2&apos;s owner cell : 1</div><div class="line">Boundary patch #1&apos;s face #3&apos;s owner cell : 3</div><div class="line">Boundary patch #1&apos;s face #4&apos;s owner cell : 0</div><div class="line">Boundary patch #1&apos;s face #5&apos;s owner cell : 1</div></pre></td></tr></table></figure></p>
<p>这里的0号bounary patch是movingWall，1号boundary patch是fixedWall。可以看到这里并没有处理因为计算1D/2D问题而声明的empty类型的boundary patch （frontAndBack），事实上，我在写CFD程序时也确实不需要处理empty patch，因为从一个empty patch的某个face上流入的必然等于从其相对那个face上流出的，其合贡献为0。</p>
<p>除了faceCell()函数外，还可以获取boundary patch的更多信息，比如name，start（该patch第一个face中在所有的face中的位置）。更多信息可以查看<br><code>$FOAM_SRC/finiteVolume/fvMesh/fvPatches/fvPatch/fvPatch.H</code>文件。 </p>
<p>至于为什么是这个文件，我们可以浏览源代码顺藤摸瓜搞清楚这里面的boundary patch和mesh的关系以及其中涉及到的类和相应的文件。 很多时候浏览源代码也可以获得很多信息。</p>
<p>首先这里的mesh.boundary()返回的对象类类型是<code>fvBoundaryMesh</code>, 这可以从fvMesh的头文件<br><code>$FOAM_SRC/finiteVolume/fvMesh/fvMesh.H</code>中boundary()的函数声明看到：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//- Return reference to boundary mesh</span></div><div class="line"><span class="function"><span class="keyword">const</span> fvBoundaryMesh&amp; <span class="title">boundary</span><span class="params">()</span> <span class="keyword">const</span></span>;</div></pre></td></tr></table></figure></p>
<p>在去查找<code>fvBoundaryMesh</code>类的头文件<code>$FOAM_SRC/finiteVolume/fvMesh/fvBoundaryMesh/fvBoundaryMesh.H</code>发现它是继承自<code>fvPatchList</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"><span class="keyword">class</span> fvBoundaryMesh</div><div class="line">:</div><div class="line">    <span class="keyword">public</span> fvPatchList</div><div class="line">&#123;</div><div class="line">    <span class="comment">// Private data</span></div><div class="line">...</div></pre></td></tr></table></figure>
<p>而fvPatchList的声明是通过typedef实现的, 在<code>$FOAM_SRC/finiteVolume/fvMesh/fvPatches/fvPatch/fvPatchList.H</code>可以看到<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> PtrList&lt;fvPatch&gt; fvPatchList;</div></pre></td></tr></table></figure></p>
<p>可以看到fvPatchList就是一个fvPatch的指针数组（<code>PtrList</code>）。现在去看看<code>fvPatch</code>类的头文件，在<code>$FOAM_SRC/finiteVolume/fvMesh/fvPatches/fvPatch/fvPatch.H</code>。<br>这里的fvPatch指的就是我们说的boundary patch。  其Access类型的函数可以返回诸多我们感兴趣的数据，比如<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">         <span class="comment">//- Return name</span></div><div class="line">         <span class="function"><span class="keyword">const</span> word&amp; <span class="title">name</span><span class="params">()</span> <span class="keyword">const</span></span></div><div class="line">         &#123;</div><div class="line">             <span class="keyword">return</span> polyPatch_.name();</div><div class="line">         &#125;</div><div class="line">         ...</div><div class="line">         <span class="comment">//- Return size</span></div><div class="line">         <span class="function"><span class="keyword">virtual</span> label <span class="title">size</span><span class="params">()</span> <span class="keyword">const</span></span></div><div class="line">         &#123;</div><div class="line">             <span class="keyword">return</span> polyPatch_.size();</div><div class="line">         &#125;</div><div class="line">         ...</div><div class="line"></div><div class="line">     <span class="comment">// Access functions for geometrical data</span></div><div class="line"></div><div class="line">         <span class="comment">//- Return face centres</span></div><div class="line">         <span class="function"><span class="keyword">const</span> vectorField&amp; <span class="title">Cf</span><span class="params">()</span> <span class="keyword">const</span></span>;</div><div class="line"></div><div class="line">         <span class="comment">//- Return neighbour cell centres</span></div><div class="line">         tmp&lt;vectorField&gt; Cn() <span class="keyword">const</span>;</div><div class="line"></div><div class="line">         <span class="comment">//- Return face area vectors</span></div><div class="line">         <span class="function"><span class="keyword">const</span> vectorField&amp; <span class="title">Sf</span><span class="params">()</span> <span class="keyword">const</span></span>;</div><div class="line"></div><div class="line">         ...</div></pre></td></tr></table></figure></p>
<p>有时候在写后处理程序时希望通过boundary patch的名字找到boundary patch的编号，这可以通过fvBondaryMesh提供的findPatchID函数实现，<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//- Find patch index given a name</span></div><div class="line"><span class="function">label <span class="title">findPatchID</span><span class="params">(<span class="keyword">const</span> word&amp; patchName)</span> <span class="keyword">const</span></span>;</div></pre></td></tr></table></figure></p>
<p>举个例子，我们希望找到HelloWorld case里面的fixedWall对应的boundary patch编号，可以用下面的代码实现：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// find patch ID by name</span></div><div class="line">Info &lt;&lt; <span class="string">"Patch fixedWalls's patchID = "</span> &lt;&lt; mesh.boundary().findPatchID(<span class="string">"fixedWalls"</span>) &lt;&lt; <span class="built_in">endl</span>;</div></pre></td></tr></table></figure></p>
<p>程序输出是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Patch fixedWalls&apos;s patchID = 1</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/10/06/of-fvMesh/" data-id="ciu15g4ke0006zcux8tqrcvyi" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OpenFOAM/">OpenFOAM</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-of-use-runtime-md" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/29/of-use-runtime-md/" class="article-date">
  <time datetime="2016-09-29T02:24:49.000Z" itemprop="datePublished">2016-09-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/29/of-use-runtime-md/">OpenFOAM 使用Time 控制程序主循环</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>接着上一个post OpenFOAM创建应用程序讲。上次的应用程序出了Info输出流是OpenFOAM提供的，其他的东西就是平白的C语言代码，跟OpenFOAM没有啥关系。这次来试试case目录里面的<code>system/controlDict</code>文件是如何跟我们的应用程序关联起来的。</p>
<p>先看一个例子<code>$FOAM_SOLVERS/basic/laplacianFoam</code>这个求解Laplace方程的标准求解器里面的是怎么弄的。</p>
<p>可以发现<code>laplacianFoam.C</code> 开头是这样的（其实大多数求解器都是这样开头的）：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></div><div class="line">&#123;</div><div class="line">    <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"setRootCase.H"</span></span></div><div class="line"></div><div class="line">    <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"createTime.H"</span></span></div><div class="line">    <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"createMesh.H"</span></span></div><div class="line">    <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"createFields.H"</span></span></div><div class="line"></div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>后面的两行应该是创建网格和物理场，这里我们暂时不讨论。主要看<code>setRootCase.H</code>和<code>createTime.H</code>。<br>这两个文件在当前目录<code>$FOAM_SOLVERS/basic/laplacianFoam</code>目录里面找不到、去<code>Make/options</code>里面看看头文件位置发现应该是在$FOAM_SRC/finiteVoluem/lnInclude下面，或者直接使用文件查找命令find在<code>$FOAM_SRC</code>目录按文件名查找它们。比如这个<code>setRootCase.H</code>文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ find $FOAM_SRC -name setRootCase.H </div><div class="line">$FOAM_SRC/OpenFOAM/include/setRootCase.H</div><div class="line">$FOAM_SRC/OpenFOAM/lnInclude/setRootCase.H</div></pre></td></tr></table></figure></p>
<p>我这里的输出把用$FOAM_SRC替换了路径前缀<code>/home/lhzhu/OpenFOAM/OpenFOAM-2.4.0/src</code>。这里输出有两行，其实第二个文件只是第一个文件的链接（对应Windows的快捷方式）。下面这个命令可以验证。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ls <span class="_">-l</span> <span class="variable">$FOAM_SRC</span>/OpenFOAM/lnInclude/<span class="built_in">set</span>RootCase.H</div></pre></td></tr></table></figure>
<p>我们可以看看这个<code>setRootCase.H</code>和<code>createTime.H</code>的内容:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ cat <span class="variable">$FOAM_SRC</span>/OpenFOAM/lnInclude/<span class="built_in">set</span>RootCase.H</div></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// setRootCase.H</span></div><div class="line"><span class="comment">// ~~~~~~~~~~~~~</span></div><div class="line"></div><div class="line">    Foam::<span class="function">argList <span class="title">args</span><span class="params">(argc, argv)</span></span>;</div><div class="line">    <span class="keyword">if</span> (!args.checkRootCase())</div><div class="line">    &#123;</div><div class="line">        Foam::FatalError.<span class="built_in">exit</span>();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ cat <span class="variable">$FOAM_SRC</span>/OpenFOAM/lnInclude/createTime.H</div></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// createTime.H</span></div><div class="line"><span class="comment">// ~~~~~~~~~~~~</span></div><div class="line"></div><div class="line">    Foam::Info&lt;&lt; <span class="string">"Create time\n"</span> &lt;&lt; Foam::<span class="built_in">endl</span>;</div><div class="line"></div><div class="line">    Foam::<span class="function">Time <span class="title">runTime</span><span class="params">(Foam::Time::controlDictName, args)</span></span>;</div></pre></td></tr></table></figure>
<p>可以发现这两个文件非常简单，总共加起来就是几行。OpenFOAM把这两个文件放在这里是因为基本所有的求解器都要来这么几行。其实我们也完全可以手动把这几行手动加到main函数开头。<code>#include XXX.H</code>这种语句原本就是告诉编译器<em>预处理时把XXX.H文件的内容贴到此处</em>。</p>
<p><code>#include &quot;createTime.H&quot;</code> 创建一个Time对象。我们通过这个对象和<code>system/controlDict</code>文件来让程序输出10句话。这跟让显式求解器程序往前推进10个时间步概念上类似。写显式求解器，去参考典型的可压缩求解器rhoCentralFoam, 看看里面是怎么推进时间步的。这个求解器在<code>$FOAM_SOLVERS/compressible/rhoCentralFoam</code>。可以发现是在main函数里面用<code>while(runTime.run()){runTime++; ...}</code> 这段代码来循环推进时间步的。</p>
<p>现在我们接着改我们的HelloWorld程序。在<code>HelloWorld.C</code>的基础上加上前面讨论的这些行，让程序每一个都输出”Running…” 和当前的物理时间。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></div><div class="line">&#123;</div><div class="line">    <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"setRootCase.H"</span></span></div><div class="line">    <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"createTime.H"</span></span></div><div class="line"></div><div class="line">... </div><div class="line"></div><div class="line">    <span class="comment">// use runTime</span></div><div class="line">    Info &lt;&lt; <span class="string">"Starting time looping"</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">while</span>(runTime.run())</div><div class="line">    &#123;</div><div class="line">    	runTime++;</div><div class="line">        Info &lt;&lt; <span class="string">"Running... "</span> &lt;&lt; <span class="string">"Time = "</span> &lt;&lt; runTime.timeName() &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    &#125;</div><div class="line">    Info &lt;&lt; <span class="string">"end!"</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line"> </div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>物理时间可以用<code>runTime.timeName()</code>得到。</p>
<p>再次<code>wmake</code>编译HelloWorld。</p>
<p>接着我们来准备一个case目录来运行这个HelloWorld。前面开发程序的终端先不管， 另外开个ssh终端(命令窗口), </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ of240</div><div class="line">$ run</div><div class="line">$ mkdir -p HelloWorld/system</div><div class="line">$ <span class="built_in">cd</span> HelloWorld</div><div class="line">$ cp <span class="variable">$FOAM_TUTORIALS</span>/basic/laplacianFoam/flange/system/controlDict system</div></pre></td></tr></table></figure>
<p>这里我们直接从一个教程算例中复制了controDict文件过来。接下来修改里面里面的endTime为1，deltaTime为0.1，表示时间步长为0.1，到时间为1时结束运行，这样就可以让程序主循环跑10次了。</p>
<p>然后就可以运行HelloWorld看看结果了：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ HelloWorld</div></pre></td></tr></table></figure></p>
<p>程序输出的主要部分如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">Create time</div><div class="line"></div><div class="line">Hello world!</div><div class="line">Dear FOAMers,</div><div class="line">I come from Wuhan, China</div><div class="line">I&apos;m from MyLib, funA()</div><div class="line">I&apos;m from MyLib, funB()</div><div class="line">Starting time looping</div><div class="line">Running... Time = 0.1</div><div class="line">Running... Time = 0.2</div><div class="line">Running... Time = 0.3</div><div class="line">Running... Time = 0.4</div><div class="line">Running... Time = 0.5</div><div class="line">Running... Time = 0.6</div><div class="line">Running... Time = 0.7</div><div class="line">Running... Time = 0.8</div><div class="line">Running... Time = 0.9</div><div class="line">Running... Time = 1</div><div class="line">end!</div></pre></td></tr></table></figure></p>
<p>现在可以用controlDict控制我们的HelloWorld的主循环了。注意这里用到的时固定时间步长循环的方法，后面我们会讲到利用CFL数(Conant数)控制可变时间步长的方法。</p>
<p>访问当前步的时间步长可以用<code>Time.deltaValue()</code>函数, 如<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> scalar dt = runTime.deltaValue();</div></pre></td></tr></table></figure></p>
<p>我们如果想在system/controlDict自定义新的控制参数，可以使用Time.controlDict()访问这些参数。下面我们分别在controlDict里面增加一个浮点数(testParameter)和一个整数参数(labelTp)：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">$ tail  system/controlDict</div><div class="line">timePrecision   6;</div><div class="line"></div><div class="line">runTimeModifiable true;</div><div class="line"></div><div class="line">testParameter   1.4;</div><div class="line"></div><div class="line">labelTp   2;</div><div class="line"></div><div class="line"></div><div class="line">// ************************************************************************* //</div></pre></td></tr></table></figure></p>
<p>在HelloWorld程序里面通过Time.controlDict()对象可以访问这些参数,<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// self-defined control parameter</span></div><div class="line">scalar tp =  runTime.controlDict().lookupOrDefault&lt;scalar&gt;(<span class="string">"testParameter"</span>, <span class="number">2.0</span>);</div><div class="line">Info &lt;&lt; <span class="string">"testParameter = "</span> &lt;&lt; tp &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">label ltp =  runTime.controlDict().lookupOrDefault&lt;label&gt;(<span class="string">"labelTp"</span>, <span class="number">2.0</span>);</div><div class="line">Info &lt;&lt; <span class="string">"labelTp = "</span> &lt;&lt; ltp &lt;&lt; <span class="built_in">endl</span>;</div></pre></td></tr></table></figure></p>
<p>注意： OpenFOAM里面使用label表示正整数、使用scalar表示浮点数，而scalar默认就是double类型的。</p>
<p>当然Time.controlDict也可以访问其他通用的控制参数。 另外，虽然这个Time.controlDict()机制可以往程序里面传递参数，但是我们一般不把时间步长控制以外的参数比如类似物理粘性放到这个system/controlDict里面，而是单独弄一个输出输出字典文件(IOdictionary)来读参数。本身system/controlDict在OpenFOAM内部也表示为IOdictionary对象。</p>
<p>DONE!!!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/09/29/of-use-runtime-md/" data-id="ciu15g4kn000czcuxby94prbt" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OpenFOAM/">OpenFOAM</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-of-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/29/of-hello-world/" class="article-date">
  <time datetime="2016-09-29T00:55:23.000Z" itemprop="datePublished">2016-09-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/29/of-hello-world/">OpenFOAM 创建程序和使用动态链接库</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="创建应用程序"><a href="#创建应用程序" class="headerlink" title="创建应用程序"></a>创建应用程序</h2><p>创建用户applications目录, 创建HelloWorld目录作为应用程序的源代码目录<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ mkdir –p <span class="variable">$FOAM_RUN</span>/../applications</div><div class="line">$ <span class="built_in">cd</span> <span class="variable">$FOAM_RUN</span>/../applications</div><div class="line">$ mkdir HelloWorld</div><div class="line">$ <span class="built_in">cd</span> HelloWorld</div></pre></td></tr></table></figure></p>
<p>源程序文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ cat HelloWorld.C</div></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"fvCFD.H"</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></div><div class="line">&#123;</div><div class="line">    Info &lt;&lt; <span class="string">"Hello world!"</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    Info &lt;&lt; <span class="string">"Dear FOAMers,"</span> &lt;&lt; nl </div><div class="line">        &lt;&lt; <span class="string">"I come from Wuhan, China"</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>编写Make文件，包括Make/files和Make/options。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ cat Make/files</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">HelloWorld.C</div><div class="line"></div><div class="line">EXE = $(FOAM_USER_APPBIN)/HelloWorld</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ cat Make/options</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">EXE_INC = \</div><div class="line">    -I$(LIB_SRC)/finiteVolume/lnInclude \</div><div class="line">    -I$(LIB_SRC)/meshTools/lnInclude</div><div class="line"></div><div class="line">EXE_LIBS = -lfiniteVolume \</div><div class="line">           -lmeshTools</div></pre></td></tr></table></figure>
<p>使用wmake编译<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ wmake</div></pre></td></tr></table></figure></p>
<p>运行程序<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ HelloWorld</div></pre></td></tr></table></figure></p>
<p>这里可以直接使用HelloWorld命令，而不给全它的路径，是因为其所在的$FOAM_USER_APPBIN目录已经在PATH环境变量里面了。</p>
<h2 id="创建并链接动态库"><a href="#创建并链接动态库" class="headerlink" title="创建并链接动态库"></a>创建并链接动态库</h2><p>下面我们开始创建一个叫MyLib的动态链接库，里面有两个简单函数。之后在HelloWorld程序里面调用这两个库函数。</p>
<p>MyLib库的源代码就在HelloWorld目录里面创建：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ mkdir MyLib</div></pre></td></tr></table></figure>
<p>接着在MyLib目录里面创建库的源程序和头文件。首先看MyLib库的头文件，<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ cat MyLib/MyLib.H</div></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> MyLib_H</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> MyLib_H</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"fvCFD.H"</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">funA</span><span class="params">()</span></span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">funB</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure>
<p>再看库的源文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ cat MyLib/MyLib.C</div></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"MyLib.H"</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">funA</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    Info &lt;&lt; <span class="string">"I'm from MyLib, funA()"</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">funB</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    Info &lt;&lt; <span class="string">"I'm from MyLib, funB()"</span> &lt;&lt; <span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最后为这个库的写Make文件如下<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ cat MyLib/Make/files</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">MyLib.C</div><div class="line"></div><div class="line">LIB = $(FOAM_USER_LIBBIN)/libMyLib</div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ cat MyLib/Make/options</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">EXE_INC = \</div><div class="line">    -I$(LIB_SRC)/finiteVolume/lnInclude \</div><div class="line">    -I$(LIB_SRC)/meshTools/lnInclude</div><div class="line"></div><div class="line">EXE_LIBS = -lfiniteVolume \</div><div class="line">           -lmeshTools</div></pre></td></tr></table></figure>
<p>现在可以用wmake编译这个生成动态链接库了，在HelloWorld目录执行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wmake libso MyLib</div></pre></td></tr></table></figure></p>
<p>或者进入MyLib目录执行<code>wmake libso</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">cd</span> </div><div class="line">$ wmake libso</div></pre></td></tr></table></figure></p>
<p>都可以。编译成功后会提示生成的动态链接库文件会存放在$FOAM_USER_APPBIN目录。</p>
<p>接下来我们在HelloWorld里面使用MyLib这个动态链接库的<code>funA()</code>和<code>funB()</code>函数。当然先要在HelloWorld.C里面包含头文件”MyLib.H”，<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"fvCFD.H"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"MyLib.H"</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></div><div class="line">&#123;</div><div class="line">    ...</div><div class="line">    <span class="comment">// use dynamic library</span></div><div class="line">    funA();</div><div class="line">    funB();</div><div class="line">    ...</div></pre></td></tr></table></figure></p>
<p>在HelloWorld的<code>Make/options</code>里面添加MyLib库的位置(-L选项)、库头文件位置(-I)、库文件(-l)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ cat Make/options</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">EXE_INC = \</div><div class="line">    -I$(LIB_SRC)/finiteVolume/lnInclude \</div><div class="line">    -I$(LIB_SRC)/meshTools/lnInclude \</div><div class="line">    -IMyLib/lnInclude</div><div class="line"></div><div class="line">EXE_LIBS = \</div><div class="line">    -L$(FOAM_USER_LIBBIN) \</div><div class="line">    -lfiniteVolume \</div><div class="line">    -lmeshTools \</div><div class="line">    -lMyLib</div></pre></td></tr></table></figure>
<p>重新编译HelloWorld<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ wmake</div></pre></td></tr></table></figure></p>
<p>最后运行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ HelloWorld</div></pre></td></tr></table></figure></p>
<p>输出如下结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Dear FOAMers,</div><div class="line">I come from Wuhan, China</div><div class="line">I&apos;m from MyLib, funA()</div><div class="line">I&apos;m from MyLib, funB()</div></pre></td></tr></table></figure></p>
<p>DONE!!!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/09/29/of-hello-world/" data-id="ciu15g4kj0008zcuxbj89r6wd" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OpenFOAM/">OpenFOAM</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-OpenFOAM-Learning-Resources" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/28/OpenFOAM-Learning-Resources/" class="article-date">
  <time datetime="2016-09-28T08:13:55.000Z" itemprop="datePublished">2016-09-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/28/OpenFOAM-Learning-Resources/">OpenFOAM 学习资料</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这里罗列我学习和使用OpenFOAM过程中参考到的一些资料，包括一些官方文档、幻灯片、网址等等。大多数都提供了文件连接或者下载最新版本的地址。</p>
<h2 id="官方资料"><a href="#官方资料" class="headerlink" title="官方资料"></a>官方资料</h2><ul>
<li><a href="http://openfoam.org/resources/" target="_blank" rel="external">官方资料网站</a> : 这里常用资料下载连接，还提供张量数学、linux命令等简短的基础教程。另外上面也有<a href="http://cfd.direct/openfoam/user-guide/" target="_blank" rel="external">网页版本的OpenFOAM User’s Guide</a>。</li>
<li><a href="https://raw.githubusercontent.com/OpenFOAM/OpenFOAM-dev/master/doc/Guides/OpenFOAMUserGuide-A4.pdf" target="_blank" rel="external">最新OpenFOAM User’s Guide PDF版本</a> 提供算例教程，介绍程序和库的组织和编译、如何运行程序、标准求解器和使用工具、OpenFOAM算例组织和运行控制、网格、边界条件、后处理、物理和湍流模型等内容。</li>
<li><a href="http://cfd.direct/openfoam/user-guide/" target="_blank" rel="external">最新OpenFOAM User’s Guide Web版本</a></li>
<li><a href="http://foam.sourceforge.net/docs/Guides-a4/OpenFOAMUserGuide-3-0-1-Chinese.pdf" target="_blank" rel="external">OpenFOAM User’s Guide 中文文档</a></li>
<li><a href="http://foam.sourceforge.net/docs/Guides-a4/ProgrammersGuide.pdf" target="_blank" rel="external">OpenFOAM Programer’s Guide</a> 这个文档相比User’s Guide简短得多，里面最重要的内容是第二章 – <strong>Discretisation procedures</strong>。 里面会讲到网格表示、空间时间离散、边界条件等稍微偏实现细节的内容。对于开发OpenFOAM求解器的用户来说非常有用。</li>
<li><a href="https://github.com/OpenFOAM" target="_blank" rel="external">GitHub上的官方OpenFOAM代码仓库</a> : 所谓“开源”，开放源代码就在这里。包括最新发布版本、历史版本和当前正在开发的版本。</li>
<li><a href="http://cpp.openfoam.org/" target="_blank" rel="external">OpenFOAM C++ Source Guide</a> : Doxgen生成的OpenFOAM C++源代码文档。对于大型C++项目，这种结构化的源代码文档很有必要。看这个比直接浏览C++源代码更为方便。</li>
</ul>
<p>上面的大多数资料会随着OpenFOAM的发布持续更新。注意除了<a href="http://www.openfoam.org" target="_blank" rel="external">www.openfoam.org</a>，<a href="http://www.openfoam.com" target="_blank" rel="external">www.openfoam.com</a>也算是官方网站。区别是前者是OpenFOAM基金会的网站，而后者是OpenCFD(ESI集团)公司的网站。开源软件的商标、版权、运作都比较复杂。关于这两者的关系可以参考<a href="https://en.wikipedia.org/wiki/OpenFOAM?oldformat=true#History" target="_blank" rel="external">这里</a>。</p>
<h2 id="MSc-PhD-course-in-CFD-with-OpenSource-software-幻灯片"><a href="#MSc-PhD-course-in-CFD-with-OpenSource-software-幻灯片" class="headerlink" title="MSc/PhD course in CFD with OpenSource software 幻灯片"></a><a href="http://www.tfd.chalmers.se/~hani/kurser/OS_CFD_2015/" target="_blank" rel="external"><strong>MSc/PhD course in CFD with OpenSource software</strong></a> 幻灯片</h2><ul>
<li>Hakan Nilsson, <a href="/documents/applicationsAndCaseSetup.pdf">A first look at applications and the icoFoam/cavity work procedure</a></li>
<li>Hakan Nilsson, <a href="moreTutorials.pdf">How to find solver and utility tutorials in the source code, and how to figure out how to use them</a></li>
<li>Hakan Nilsson, <a href="/documents/implementApplication.pdf">How to implement your own application</a></li>
<li>Hakan Nilsson, <a href="/document/implementApplication_example_rodFoam.pdf">How to implement an application, the rodFoam case</a></li>
<li>Hakan Nilsson, <a href="/documents/implementBoundaryCondition.pdf">How to implement a new boundary condition</a></li>
<li>Hakan Nilsson, <a href="/documents/basicOfC++.pdf">Basics of C++ and object orientation in OpenFOAM</a></li>
<li>Hakan Nilsson, <a href="/documents/objectOrientation.pdf">Object orientation in C++ and OpenFOAM</a></li>
<li>Hakan Nilsson, <a href="/documents/highLevelProgramming.pdf">Solving PDE with OpenFOAM</a></li>
<li>Hakan Nilsson, <a href="/documents/debugging.pdf">Debugging OpenFOAM</a></li>
<li>Hakan Nilsson, <a href="/documents/aLookInsideIcoFoam.pdf">A look inside icoFoam (and pisoFoam)</a></li>
<li>Hakan Nilsson, <a href="/documents/applicationSourceCode.pdf">A first look at the source code of applications</a></li>
<li>Hakan Nilsson, <a href="/documents/implementFunctionObject.pdf">How to implement a functionObject</a></li>
</ul>
<h2 id="论文"><a href="#论文" class="headerlink" title="论文"></a>论文</h2><ul>
<li>OpenFOAM开发者Hrvoje Jasak的博士论文 <a href="http://powerlab.fsb.hr/ped/kturbo/OpenFOAM/docs/HrvojeJasakPhD.pdf" target="_blank" rel="external">Error Analysis and Estimationfor the Finite Volume Methodwith Applications to Fluid Flows</a>.</li>
<li>Hrvoje Jasak et al., OpenFOAM: A C++ Library for Complex Physics Simulations, International Workshop on Coupled Methods in Numerical Dynamics IUC, Dubrovnik, Croatia, September 19th-21st 2007.</li>
</ul>
<h2 id="书籍"><a href="#书籍" class="headerlink" title="书籍"></a>书籍</h2><ul>
<li>F. Moukalled, L. Mangali, The Finite Volume Method in Computational Fluid Dynamics, An Advanced Introduction with  OpenFOAM and Matlab, Springer, 2015</li>
<li>Jens Höpken, <a href="http://www.sourceflux.de/book/" target="_blank" rel="external">The OpenFOAM Technology Primer</a></li>
</ul>
<h2 id="Instructional-workshop-on-OpenFOAM-programming-系列幻灯片"><a href="#Instructional-workshop-on-OpenFOAM-programming-系列幻灯片" class="headerlink" title="Instructional workshop on OpenFOAM programming 系列幻灯片"></a><a href="http://pavanakumar.github.io/compressibleFoam/of_tut.html" target="_blank" rel="external">Instructional workshop on OpenFOAM programming</a> 系列幻灯片</h2><p>这里面讲的是如何开发一个求解器。并且里面也提前介绍了很多开发solver需要用到的概念。</p>
<h2 id="WIKKI公司的一些幻灯片"><a href="#WIKKI公司的一些幻灯片" class="headerlink" title="WIKKI公司的一些幻灯片"></a>WIKKI公司的一些幻灯片</h2><ul>
<li>Hrvoje Jasak and Henrik Rusche, <a href="/documents/FiveBasicClasses.pdf">Five Basic Classes in OpenFOAM</a></li>
<li>Hrvoje Jasak, <a href="/documents/FiniteVolume.pdf">Finite Volume Discretisation with Polyhedral Cell Support</a></li>
<li>Hrvoje Jasak, <a href="/documents/HandlingParallelisationOpenFOAM.pdf">Handling Parallelisation in OpenFOAM</a></li>
</ul>
<h2 id="OpenFOAM-Workshop上的课程材料"><a href="#OpenFOAM-Workshop上的课程材料" class="headerlink" title="OpenFOAM Workshop上的课程材料"></a><a href="http://www.openfoamworkshop.org/" target="_blank" rel="external">OpenFOAM Workshop</a>上的<a href="http://www.openfoamworkshop.org/courses" target="_blank" rel="external">课程材料</a></h2><p>还有历年举办的OpenFOAM Workshop的幻灯片资料都可以<a href="https://sourceforge.net/projects/openfoam-extend/files/OpenFOAM_Workshops/" target="_blank" rel="external">在这里找到</a></p>
<h2 id="其他幻灯片"><a href="#其他幻灯片" class="headerlink" title="其他幻灯片"></a>其他幻灯片</h2><ul>
<li>Tommaso Lucchini, <a href="/documents/Cpp4Cfd.pdf">OpenFOAM postprocessing and advanced running options</a></li>
<li>Tommaso Lucchini, <a href="/documents/ofPostProcessingLucchini.pdf">Introduction to C++ for CFD modeling</a></li>
<li>Tommaso Lucchini, <a href="/documents/runningInParallelLucchini.pdf">Running OpenFOAM in parallel</a></li>
<li>Gianluca Montenegro, <a href="/documents/openFoamStructure.pdf">OpenFOAM structure</a></li>
<li>Tommaso Lucchini, <a href="/documents/programmingTutorial.pdf">OpenFOAM programming tutorial</a></li>
<li>Fumiya Nozaki, <a href="/documents/openfoaminterpolation.pdf">OpenFOAM Spatial Interpolation</a></li>
<li>Fumiya Nozaki, <a href="/documents/openfoamprogrammingtips.pdf">OpenFOAM Programming Tips</a></li>
<li>Fumiya Nozaki, <a href="/documents/openfoamlimitedgrad.pdf">OpenFOAM Limited Version of Gradient Schemes</a></li>
</ul>
<h2 id="网站、博客、论坛"><a href="#网站、博客、论坛" class="headerlink" title="网站、博客、论坛"></a>网站、博客、论坛</h2><ul>
<li><a href="https://openfoamwiki.net" target="_blank" rel="external">OpenFOAMWiki</a></li>
<li><a href="http://dyfluid.com/" target="_blank" rel="external">东岳流体</a></li>
<li><a href="http://xiaopingqiu.github.io/" target="_blank" rel="external">Giskard’s CFD Learning Tricks</a></li>
<li><a href="http://blog.sina.com.cn/s/articlelist_1608493030_0_1.html" target="_blank" rel="external">苏军伟的博客</a></li>
<li><a href="http://www.sourceflux.de/blog/" target="_blank" rel="external">sourceflux博客</a></li>
<li><a href="http://blog.sina.com.cn/s/blog_97cadb820102w83i.html" target="_blank" rel="external">WayneWangY的博客</a></li>
<li><a href="http://www.cfd-china.com/" target="_blank" rel="external">CFD中国论坛</a></li>
</ul>
<h2 id="OpenFOAM-自带的test目录-FOAM-APP-test"><a href="#OpenFOAM-自带的test目录-FOAM-APP-test" class="headerlink" title="OpenFOAM 自带的test目录 $FOAM_APP/test"></a>OpenFOAM 自带的test目录 <strong>$FOAM_APP/test</strong></h2><p>这个目录里面有很多示例性质的小程序源代码，每个小程序只演示到OpenFOAM诸多概念中的一个。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/09/28/OpenFOAM-Learning-Resources/" data-id="ciu15g4jw0001zcuxyzwjvvbd" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OpenFOAM/">OpenFOAM</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-cmake_find_boost_windows" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/27/cmake_find_boost_windows/" class="article-date">
  <time datetime="2016-09-26T16:20:30.187Z" itemprop="datePublished">2016-09-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/27/cmake_find_boost_windows/">在Windows平台的CMAKE里面使用Boost</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>主要CMAKE FindBoost模块的<a href="https://cmake.org/cmake/help/v3.0/module/FindBoost.html" target="_blank" rel="external">官方文档</a>。</p>
<p>这里假设boost安装位置为<code>D:\Boost_1_61_0</code>。</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">2.8</span>)</div><div class="line"><span class="keyword">project</span> (test_boost)</div><div class="line"></div><div class="line"><span class="comment"># if on windows</span></div><div class="line"><span class="keyword">IF</span>(WIN32)</div><div class="line"></div><div class="line"><span class="keyword">set</span>(BOOST_ROOT  D:/boost_1_61_0) </div><div class="line"></div><div class="line"><span class="comment">#如果设置了BOOST_ROOT, 下面两行可以注释掉</span></div><div class="line"><span class="comment">#set(BOOST_INCLUDEDIR D:/boost_1_61_0) </span></div><div class="line"><span class="comment">#set(BOOST_LIBRARYDIR D:/boost_1_61_0/lib64-msvc-14.0)</span></div><div class="line"></div><div class="line"><span class="keyword">set</span>(Boost_USE_STATIC_LIBS <span class="keyword">ON</span>) </div><div class="line"><span class="keyword">set</span>(Boost_USE_MULTITHREADED <span class="keyword">ON</span>)  </div><div class="line"><span class="keyword">set</span>(Boost_USE_STATIC_RUNTIME <span class="keyword">OFF</span>)</div><div class="line"></div><div class="line"><span class="keyword">find_package</span>(Boost <span class="number">1.61</span>.<span class="number">0</span> REQUIRED COMPONENTS program_options regex)</div><div class="line"></div><div class="line"><span class="keyword">if</span>(Boost_FOUND)</div><div class="line">    <span class="keyword">include_directories</span>(<span class="variable">$&#123;Boost_INCLUDE_DIRS&#125;</span>) </div><div class="line"><span class="keyword">endif</span>()</div><div class="line"></div><div class="line"><span class="comment"># A test project that use Boost.ProgramOptions and Boost.Regex。</span></div><div class="line"><span class="keyword">aux_source_directory</span>(test_boost TEST_BOOST) </div><div class="line"><span class="keyword">add_executable</span>(test_boost <span class="variable">$&#123;TEST_BOOST&#125;</span>)</div><div class="line"><span class="keyword">target_link_libraries</span>(test_boost <span class="variable">$&#123;Boost_PROGRAM_OPTIONS_LIBRARY&#125;</span> <span class="variable">$&#123;Boost_REGEX_LIBRARY&#125;</span>)</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/09/27/cmake_find_boost_windows/" data-id="ciu15g4jq0000zcuxt5srwbq7" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-install-boost-on-windows" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/27/install-boost-on-windows/" class="article-date">
  <time datetime="2016-09-26T16:20:30.154Z" itemprop="datePublished">2016-09-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/27/install-boost-on-windows/">在Windows上安装Boost</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>官方文档:<a href="http://www.boost.org/doc/libs/1_61_0/more/getting_started/windows.html" target="_blank" rel="external">Getting Started on Windows</a></p>
<p>Boost里面有很多库，分为需要编译的和不需要编译的（header file only）。</p>
<p>如果只需要使用不需要编译的库（如Boost.PropertyTree）则只需要从官方网站下载源代码解压缩即可使用。<a href="http://www.boost.org/" target="_blank" rel="external">Boost官网</a>上的Downloads-&gt;Latest Rease-&gt;Version x.xx.x 就是下载链接。解压后放到一个目录，比如D:\boost盘。这里以1.61.0版本为例，则安装目录为D:\boost\boost_1_61_0。在Visual Studio 的项目Properties里面的VC++ Directories-&gt;Include Directories 里面添加条目D:\boost\boost_1_61_0即可完成编译。可以发现<code>D:\boost\boost_1_61_0\</code>目录是空的，因为官方发布的source pack里面是没有预编译的。</p>
<p>如果需要使用需要编译的库，如 Boost.FileSystem或者Boost.ProgramOptions，则还需要编译这些库。Boost目录(<code>D:\boost\boost_1_61_0</code>)里面的<code>booststrap.bat</code>脚本就是编译脚本。这里我们参照<a href="https://studiofreya.com/2016/09/01/how-to-build-boost-1-61-with-visual-studio-2015/" target="_blank" rel="external">这篇博文</a>使用Visual Studio 2015来编译boost_1_61_0。</p>
<ol>
<li><p>在<code>D:\boost</code>目录里面创建脚本<code>build_boost_1_61_0_vs2015.bat</code>,内容如下：</p>
 <figure class="highlight bat"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">call</span> "<span class="variable">%VS140COMNTOOLS%</span>..\..\VC\vcvarsall.bat" x86</div><div class="line"> </div><div class="line"><span class="built_in">set</span> cores=<span class="variable">%NUMBER_OF_PROCESSORS%</span></div><div class="line"><span class="built_in">echo</span> Building boost with <span class="variable">%cores%</span> cores</div><div class="line"> </div><div class="line"><span class="built_in">cd</span> boost_1_61_0</div><div class="line"><span class="keyword">call</span> bootstrap.bat</div><div class="line"><span class="comment"> </span></div><div class="line">rem Most libraries can be static libs</div><div class="line">b2 -j<span class="variable">%cores%</span> toolset=msvc-<span class="number">14</span>.<span class="number">0</span> address-model=<span class="number">64</span> architecture=x86 link=static threading=multi runtime-link=shared --build-<span class="built_in">type</span>=minimal stage --stagedir=stage/x64 </div><div class="line">b2 -j<span class="variable">%cores%</span> toolset=msvc-<span class="number">14</span>.<span class="number">0</span> address-model=<span class="number">32</span> architecture=x86 link=static threading=multi runtime-link=shared --build-<span class="built_in">type</span>=minimal stage --stagedir=stage/win32</div><div class="line"> </div><div class="line"><span class="built_in">pause</span></div></pre></td></tr></table></figure>
<p> 这里是设置使用Visual Studio (msvc-14.0) toolset编译32位和64位的静态库文件，并且设置了生成的库文件位置为stage目录。更详细的编译选项可以参考官方文档。</p>
</li>
<li><p>打开cmd，进入D:\boost目录，执行<code>builde_boost_1_61_0_vs2015.bat</code>脚本，等待编译完成。编译完成后回提示 Press any key to continue。编译生成的库文件在stage目录下面。</p>
</li>
<li><p>为了区分不同编译器生成的库文件，在<code>D:\boost\boost_1_61_0</code>目录下面新建lib64-msvc-14.0目录，表示是Visual Studio 2015编译的。再把stage/x64/*.lib 拷贝到这个新建的目录下面。</p>
</li>
</ol>
<p>因为编译过程比较耗时，可以考虑直接下载<a href="https://sourceforge.net/projects/boost/files/boost-binaries/" target="_blank" rel="external">Boost Binaries Installer For Windows</a>。下载安装之后，里面直接提供了lib64-msvc-14.0等目录。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/09/27/install-boost-on-windows/" data-id="ciu15g4kl000azcux42s65qpo" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/27/hello-world/" class="article-date">
  <time datetime="2016-09-26T16:19:02.644Z" itemprop="datePublished">2016-09-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/27/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/09/27/hello-world/" data-id="ciu15g4jz0002zcuxo4yf442k" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-My-New-Post" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/26/My-New-Post/" class="article-date">
  <time datetime="2016-09-26T06:35:28.000Z" itemprop="datePublished">2016-09-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/26/My-New-Post/">My New Post</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/09/26/My-New-Post/" data-id="ciu15g4ka0004zcuxpdu44s1z" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenFOAM/">OpenFOAM</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/OpenFOAM/" style="font-size: 10px;">OpenFOAM</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/10/07/of-dsmcFoam/">OpenFOAM中的DSMC求解器dsmcFoam分析</a>
          </li>
        
          <li>
            <a href="/2016/10/06/of-fvMesh/">OpenFOAM里面的网格对象（fvMesh）</a>
          </li>
        
          <li>
            <a href="/2016/09/29/of-use-runtime-md/">OpenFOAM 使用Time 控制程序主循环</a>
          </li>
        
          <li>
            <a href="/2016/09/29/of-hello-world/">OpenFOAM 创建程序和使用动态链接库</a>
          </li>
        
          <li>
            <a href="/2016/09/28/OpenFOAM-Learning-Resources/">OpenFOAM 学习资料</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Lianhua Zhu<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>